!function(e,n){"use strict";"function"==typeof define&&define.amd?define([],(function(){return e.annyang=n(e)})):"object"==typeof module&&module.exports?module.exports=n(e):e.annyang=n(e)}("undefined"!=typeof window?window:this,(function(e,n){"use strict";var t,o=e.SpeechRecognition||e.webkitSpeechRecognition||e.mozSpeechRecognition||e.msSpeechRecognition||e.oSpeechRecognition;if(!o)return null;var r,a,i=[],c={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},s=0,l=!1,u="font-weight: bold; color: #00f;",g=!1,f=!1,d=/\s*\((.*?)\)\s*/g,p=/(\(\?:[^)]+\))\?/g,h=/(\(\?)?:\w+/g,m=/\*\w+/g,v=/[\-{}\[\]+?.,\\^$|#]/g,w=function(e){return e=e.replace(v,"\$&").replace(d,"(?:)?").replace(h,(function(e,n){return n?e:"([^\s]+)"})).replace(m,"(.*?)").replace(p,"\s*?\s*"),new RegExp("^"+e+"$","i")},y=function(e){var n=Array.prototype.slice.call(arguments,1);e.forEach((function(e){e.callback.apply(e.context,n)}))},b=function(){return r!==n},S=function(){b()||t.init({},!1)},k=function(e,n,t){i.push({command:e,callback:n,originalPhrase:t}),l&&console.log("Command successfully loaded: %c"+t,u)&&alertify.log("Command successfully loaded: %c"+t,u)},x=function(e){y(c.result,e);for(var n,t=e[0].trim(),o=0;o<e.length;o++){n=e[o].trim(),l&&console.log("Speech recognized: %c"+n,u)&&alertify.log("Speech recognized: %c"+n,u)&&recognized(n);for(var r=0,a=i.length;a>r;r++){var s=i[r],g=s.command.exec(n);if(g){var f=g.slice(1);return l&&(console.log("command matched: %c"+s.originalPhrase,u),alertify.log("command matched: "+s.originalPhrase),f.length&&console.log("with parameters",f)),s.callback.apply(this,f),void y(c.resultMatch,n,s.originalPhrase,e)}}
break}
if(console.log("recognized()"),"ongoing"==localStorage["dictation-status"]){SpeechKITT.setInstructionsText("Dictation: ");var d=localStorage["dictation-count"];d=parseInt(d)+t.split(" ").filter((function(e){return""!=e})).length,localStorage["dictation-count"]=d;var p=d+" words";SpeechKITT.setSampleCommands([p]),localStorage["dictation-data"]=localStorage["dictation-data"]+". "+t}else if(localStorage[root+'activelistener']=='on'&&localStorage[root+'quite-flag']=="off"&&localStorage[root+'speakingNow']=='N'){alertify.success("You said: "+t);document.getElementById("newJSWM999").value=t;SpeechKITT.queryWatsonAssistant(t);}
y(c.resultNoMatch,e)};return t={init:function(u,d){d=d===n||!!d,r&&r.abort&&r.abort(),(r=new o).maxAlternatives=5,r.continuous="http:"===e.location.protocol,r.lang="en-US",r.onstart=function(){f=!0,y(c.start)},r.onerror=function(e){switch(y(c.error),e.error){case "network":y(c.errorNetwork);break;case "not-allowed":case "service-not-allowed":a=!1,y((new Date).getTime()-s<200?c.errorPermissionBlocked:c.errorPermissionDenied)}},r.onend=function(){if(f=!1,y(c.end),a){var e=(new Date).getTime()-s;1e3>e?setTimeout(t.start,1e3-e):t.start()}},r.onresult=function(e){if(g)return l&&console.log("Speech heard, but annyang is paused"),!1;for(var n=e.results[e.resultIndex],t=[],o=0;o<n.length;o++)t[o]=n[o].transcript;x(t)},d&&(i=[]),u.length&&this.addCommands(u)},start:function(e){g=!1,S(),a=(e=e||{}).autoRestart===n||!!e.autoRestart,e.continuous!==n&&(r.continuous=!!e.continuous),s=(new Date).getTime();try{r.start()}catch(e){l&&console.log(e.message)}},abort:function(){a=!1,b()&&r.abort()},pause:function(){g=!0},resume:function(){t.start()},debug:function(e){l=!(arguments.length>0&&!e)},setLanguage:function(e){S(),r.lang=e},addCommands:function(n){var t;for(var o in S(),n)
if(n.hasOwnProperty(o))
if("function"==typeof(t=e[n[o]]||n[o]))k(w(o),t,o);else{if(!("object"==typeof t&&t.regexp instanceof RegExp)){l&&console.log("Can not register command: %c"+o,u);continue}
k(new RegExp(t.regexp.source,"i"),t.callback,o)}},removeCommands:function(e){return e===n?void(i=[]):(e=Array.isArray(e)?e:[e],void(i=i.filter((function(n){for(var t=0;t<e.length;t++)
if(e[t]===n.originalPhrase)return!1;return!0}))))},addCallback:function(t,o,r){if(c[t]!==n){var a=e[o]||o;"function"==typeof a&&c[t].push({callback:a,context:r||this})}},removeCallback:function(e,t){var o=function(e){return e.callback!==t};for(var r in c)c.hasOwnProperty(r)&&(e!==n&&e!==r||(c[r]=t===n?[]:c[r].filter(o)))},isListening:function(){return f&&!g},getSpeechRecognizer:function(){return r},trigger:function(e){return t.isListening()?(Array.isArray(e)||(e=[e]),void x(e)):void(l&&(f?console.log("Speech heard, but annyang is paused"):console.log("Cannot trigger while annyang is aborted")))}}}))